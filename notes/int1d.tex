\documentclass[11pt]{article}

\textwidth 6.5in
\oddsidemargin=0in
\evensidemargin=0in
\textheight 9in
\topmargin -0.5in

\usepackage{graphicx,bm,amssymb,amsmath,amsthm}

\usepackage{showlabels}

\newcommand{\bi}{\begin{itemize}}
\newcommand{\ei}{\end{itemize}}
\newcommand{\ben}{\begin{enumerate}}
\newcommand{\een}{\end{enumerate}}
\newcommand{\be}{\begin{equation}}
\newcommand{\ee}{\end{equation}}
\newcommand{\bea}{\begin{eqnarray}} 
\newcommand{\eea}{\end{eqnarray}}
\newcommand{\ba}{\begin{align}} 
\newcommand{\ea}{\end{align}}
\newcommand{\bse}{\begin{subequations}} 
\newcommand{\ese}{\end{subequations}}
\newcommand{\bc}{\begin{center}}
\newcommand{\ec}{\end{center}}
\newcommand{\bfi}{\begin{figure}}
\newcommand{\efi}{\end{figure}}
\newcommand{\ca}[2]{\caption{#1 \label{#2}}}
\newcommand{\ig}[2]{\includegraphics[#1]{#2}}
\newcommand{\tbox}[1]{{\mbox{\tiny #1}}}
\newcommand{\mbf}[1]{{\mathbf #1}}
\newcommand{\half}{\mbox{\small $\frac{1}{2}$}}
\newcommand{\vt}[2]{\left[\begin{array}{r}#1\\#2\end{array}\right]} % 2-col-vec
\newcommand{\mt}[4]{\left[\begin{array}{rr}#1&#2\\#3&#4\end{array}\right]} % 2x2
\newcommand{\eps}{\varepsilon}
\newcommand{\bigO}{{\mathcal O}}
\newcommand{\sfrac}[2]{\mbox{\small $\frac{#1}{#2}$}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\C}{\mathbb{C}}
\newcommand{\N}{\mathbb{N}}
\newcommand{\Z}{\mathbb{Z}}
\DeclareMathOperator{\re}{Re}
\DeclareMathOperator{\im}{Im}
\DeclareMathOperator{\tr}{Tr}
\DeclareMathOperator{\res}{res}
\newtheorem{thm}{Theorem}
\newtheorem{lem}[thm]{Lemma}
\newtheorem{alg}[thm]{Algorithm}
\newtheorem{pro}[thm]{Proposition}
\newtheorem{cor}[thm]{Corollary}
\newtheorem{rmk}[thm]{Remark}
\newtheorem{conj}[thm]{Conjecture}
% this work...
\newcommand{\om}{\omega}
\newcommand{\tH}{\tilde H}


\begin{document}
\title{Faster numerical computation of 1D Brillouin zone integrals in quantum physics}
\author{Alex Barnett, Jason Kaye, Lorenzo van Mu\~noz}
\date{\today}
\maketitle
\begin{abstract}
  Notes on methods for numerical approximation of density of states
  (DOS) and related integrals, in the 1D case, where the Hamiltonian
  is given by a Fourier series. They could be used
  to perform the innermost integral in IAI (iterated adaptive integration)
  from our autobz paper.
  Both scalar and small matrix cases are considered.
  This accompanies Julia benchmarking code in \texttt{contdef1d}.
\end{abstract}

Consider a crystalline quantum system with band Hamiltonian $H(k)$.
Let $k$ denote the $2\pi$-periodic wavevector (a scalar since we are in 1D), and
the Brillouin zone we may take as any periodic interval, eg, $[0,2\pi)$.
We are given the band Hamiltonian function in the form of a finite Fourier
series
\be
H(k) = \sum_{m=-M}^M H_m e^{imk}
\label{Hk}
\ee
which has $2M+1$ terms. $H$ and each $H_m$ are matrices of size $n$
(given in some Wannier basis that we need not be concerned about here).
We refer to the case $n=1$ as scalar.
For CCQ applications, $n$ is not large.
In the application, $H(k)$ is self-adjoint for all $k\in\R$,
equivalent to the symmetry $H_m^* = H_{-m}$ for all $m$, where
$^*$ indicates the complex transpose (Hermitian conjugate).

Given $M$, $\{H_m\}$ as above, $\om\in \R$, and $\eta\ge0$,
the paradigm integration task is to evaluate
\be
A = A(\om,\eta) := \int_{0}^{2\pi} \tr\, [(\om +i\eta)I - H(k)]^{-1} dk
\label{A}
\ee
The inverse may be interpreted as a Green's function, and $\eta$
a possible broadening due to temperature, disorder, interactions, etc.
The density of states at energy $\om$ is then
\be
\rho(\om) = -\frac{1}{\pi}\im A(\om,\eta)~.
\label{DOS}
\ee
% *** Tr and Im commute, but conceptuially shoudl the Tr be outermost?
The above is the simple case of constant matrix $(\om+i\eta)I$; this
can be a more general non-Hermitian matrix often denoted by
$\Sigma_\om$, still independent of $k$.
% although if not, that would just modify the F series coeffs for H.

The ``conventional'' numerical method for \eqref{A} is
to apply adaptive Gauss--Kronrod integration on the real axis.
This was proposed for the innermost integral in \cite{autobz}.
When $\eta\ll1$ and $\om$ is in a band (meaning there is as least one
$k\in\R$ where $H(k)=\om$), this adaptive scheme is expected
to refine to a $k$-scale of about $\eta$, giving a $\log(1/\eta)$ cost.

We also care about the limit $\eta\to0^+$, which cannot be directly
computed by adaptive real-axis quadrature. It could be accessed by
Richardson extrapolation from larger $\eta$ values, but we have not
studied how automated that could be.


% sssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssssss
\section{Residue method for the scalar case ($n=1)$}
\label{scalar}

Changing variable to $z=e^{ik}$,
so that $dz = i z dk$,
in the scalar case \eqref{A} becomes an integral
\be
A = \int_{0}^{2\pi} \frac{dk}{\om +i\eta - H(k)}
 = \int_{|z|=1} \frac{1}{\om +i\eta - \tH(z)} \, \frac{dz}{iz}.
\label{As}
\ee
Here $\tH:\C\to\C$ is the analytic continuation of the
Hamiltonian function in terms of $z$,
defined by
\be
\tH(e^{ik}) = H(k) \qquad \mbox{ for all } k\in\C,
\label{tH}
\ee
where we have used the analytic continuation of $H(k)$
as an entire function throughout $\C$ defined by its series \eqref{Hk}.
Note that $\tH$ is the Laurent series
\be
\tH(z) = \sum_{m=-M}^M H_m z^m,
\label{Laur}
\ee
is real-valued on the unit circle, and, when $\om$ is in a band,
some poles in the above integrand will approach the unit circle
as $\eta\to0^+$.

We apply Cauchy's residue theorem to the final integral \eqref{As}.
There are two cases for
the integrand
\be
f(z) := [iz(\om+ i\eta - \tH(z))]^{-1}.
\label{f}
\ee
Either $H\equiv c$ is constant, in which case the simple pole at the
origin gives
$A = 2\pi / (\om+i\eta-c)$, or $H$ is non-constant, so that
$H_m\neq 0$ for some $m<0$ (keeping in mind Hermitian symmetry).
The first case is trivial, so from now we deal with the second case.
Although $f$ is not defined at $z=0$ by the above, the following shows that
it may be extended to this point to give a locally analytic function.
\begin{pro}
  Let $H$ be a non-constant Fourier series \eqref{Hk}, then
  the integrand $f$ defined by \eqref{f}, where $\tH$ is defined by
  \eqref{tH}, has a removable singularity at $z=0$.
\end{pro}
\begin{proof}
  Let $p \in \{1,2, \dots, M\}$
  be the largest index $m$ for which $H_{-m} \neq 0$.
  Inserting \eqref{Laur} gives
  $$
  f(z) = \frac{1}{iz}\left( H_{-p}z^{-p} + H_{-p+1}z^{-p+1} + \dots \right)^{-1}
  =
  \frac{z^{p-1}}{iH_{-p}}\left( 1 + \frac{H_{-p+1}}{H_{-p}}z + \dots \right)^{-1}
  $$
  where the dots indicate a finite sum of higher powers of $z$.
  This defines an extension of $f$ analytic at $z=0$.
\end{proof}
In particular this means that the residue theorem may be applied to
\eqref{As}, with no further concern given to the origin.
Thus, when $\eta>0$, so that no zero of $\om + i\eta - \tH(z)$ can lie
on the unit circle, poles lie either inside or outside of this circle.
Assuming all poles are simple,
\be
A = \int_{|z|=1} f(z) dz = 2\pi \sum_{|z_j|<1} \res_{z_j} f
\ee
where each residue can be evaluated by
\be
\res_{z_j} f = \lim_{z\to z_j} (z-z_j)f(z) = \frac{i}{z_j \tH'(z_j)}
\label{res}
\ee
where $\tH'$ is the complex derivative of the Laurent series \eqref{tH}.
Since
\be
iz\tH'(z) = H'(i^{-1}\log z),
\label{deriv}
\ee
the residue can
also be written
\be
\res_{z_j} f  = \frac{-1}{H'(i^{-1}\log z_j)}
\ee
in terms of the complex wavevector derivative $H'$ of the original band
Hamiltonian \eqref{Hk}.

Numerically, the roots of the denominator $\om + i\eta - \tH(z)$
are found by noting that
$$
z^M(\om + i\eta - \tH(z))
$$
is a polynomial of degree $2M$ with coefficients
$a_j = (\om+i\eta)\delta_{jM} - H_{j-M}$ for $j=0,1,\dots,2M$.
One finds its roots by either the companion matrix
eigenvalues or iterative deflation with Laguerre's method.
Currently we use an $\bigO(M^2)$ scaling fast implementation of the former
(\cite{aurentz1,aurentz2} as coded in \texttt{AMRVW.jl})
for degrees greater than 200, else the
latter (\cite{skowron} as coded in \texttt{PolynomialRoots.jl}).
The latter is around 10 times faster for the same degree, but
appears unstable for degrees above about 200.

Finally we consider
the case $\eta\to0^+$: the denominator then often has roots lying on $|z|=1$,
corresponding to real band intersections (Fermi ``points'')
$k$ where $H(k)=\om$.
Only some of the corresponding poles in the integrand $f(z)$ of \eqref{f}
should be included in the residue theorem.
Denominator roots whose location approaches the unit circle from the inside
are included, otherwise they are excluded.
Writing $z_0(\eta)$ for the $\eta$-dependence of such a root,
taking the total $\eta$-derivative of $(\om+i\eta)-\tH(z_0(\eta)) = 0$
gives a formula $z_0' = dz_0/d\eta = i/\tH'(z_0)$.
Approaching from the inside means geometrically
$\re z_0' \overline{z_0}<0$, recalling
that $\eta$ is \textit{decreasing} to $0$.
Substituting $z_0'$ gives the criterion for inclusion
$\re i \overline{z_0}/\tH'(z_0) <0$, or, using \eqref{deriv},
$$
\re H'(k_0) > 0,
$$
where $k_0 = i^{-1} \log z_0$ is the real-valued wavevector corresponding to
the unit circle root $z_0$, and $z_0\overline{z_0} = 1$ was used.
This has a simple interpretation that only up-going band intersections
should be included (where pushing $\om$ into a small imaginary
part causes the intersection to move up from the real axis, and its
image inside the unit circle).

A good numerical check for the sign is the simple test case band structure
$H(k) = \cos k$, whose only nonzero coefficients are $H_{\pm1} = 1/2$,
for which the exact (positive!) DOS is easily found by change of variable,
$$
\rho(\om) = \int_0^{2\pi} \delta(H(k)-\om) dk
= \sum_{k\in[0,2\pi]: H(k)=\om} \frac{1}{|H'(k)|}
= \frac{2}{\sin(\cos^{-1} \om)} = \frac{2}{\sqrt{1-\om^2}}
$$
in the band $|\om|<1$, and zero for $|\om|>1$.
The 1D Van Hove singularity is undefined at the band edge $\om=\pm1$.

We implement the scalar case for $\eta>0$ and $\eta=0^+$
by the method \texttt{discresi} in \texttt{Cont1DBZ}.



*** Need to discuss/research/test: nonsimple poles inside, and on unit circle
for $\eta=0^+$.




% mmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmm
\section{Residue method for the matrix case $n>1$}

% Beyn 2012 LAA, Sec 2 reviews Keldysh.





\bibliographystyle{abbrv}
\bibliography{refs}

\end{document}
